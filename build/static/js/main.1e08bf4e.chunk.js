(this.webpackJsonpwise=this.webpackJsonpwise||[]).push([[0],{133:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),c=r(93),s=r.n(c),o=r(30),i=r(11),u=r(12),l=r(19),j=r(8),d=r(199),b=r(196),p=r(200),x=r(190),h=r(194),m=r(198),O=r(24),f=r(25),g=r(191),v=(r(94),r(95),Object(n.createContext)(null)),k=Object(n.createContext)({user:{}}),w=r(2),y=function(e){localStorage.setItem("token",e)},S=function(e){localStorage.setItem("user_id",e.id),localStorage.setItem("username",e.username),localStorage.setItem("role",e.role),localStorage.setItem("created_at",e.created_at)},C=function(){return localStorage.getItem("token")},I=function(){localStorage.removeItem("token")},_=function(e){var t=e.tokenData,r=e.children,a=Object(n.useState)(t),c=Object(j.a)(a,2),s=c[0],o=c[1];return Object(w.jsx)(v.Provider,{value:{token:s,setToken:o},children:r})},U=function(e){var t=e.userData,r=e.children,a=Object(n.useState)(t),c=Object(j.a)(a,2),s=c[0],o=c[1];return Object(w.jsx)(k.Provider,{value:{user:s,setUser:o},children:r})};function D(e){var t=e.children,r=T();return console.log(r),r.token&&""!==r.token?t:Object(w.jsx)(i.a,{to:"/login",replace:!0})}function G(e){var t=e.children;return"guest"===F().user.role?Object(w.jsx)(i.a,{to:"/error",replace:!0}):t}function W(e){var t=e.children;return"superuser"===F().user.role?Object(w.jsx)(i.a,{to:"/chat/admin",replace:!0}):t}var T=function(){return Object(n.useContext)(v)},F=function(){return Object(n.useContext)(k)},M=g.a.create({baseURL:"https://wiseapi.ru/",headers:{"Content-Type":"application/json",accept:"application/json"}});M.interceptors.request.use((function(e){return Promise.resolve(e)}),(function(e){return Promise.reject(e)})),M.interceptors.response.use((function(e){return Promise.resolve(e)}),(function(e){return Promise.reject(e)}));var P=Object(O.a)((function e(){Object(f.a)(this,e)}));P.Login=function(){var e=Object(l.a)(Object(u.a)().mark((function e(t){var r;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.post("login",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P.Registration=function(){var e=Object(l.a)(Object(u.a)().mark((function e(t){var r;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.post("user/create",t);case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P.GetMe=Object(l.a)(Object(u.a)().mark((function e(){var t;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.get("user/me",{headers:{Authorization:"Bearer ".concat(C())}});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))),P.ChatGetAdmin=function(){var e=Object(l.a)(Object(u.a)().mark((function e(t,r){var n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.get("chat/admin/".concat(t),{headers:{Authorization:"Bearer ".concat(r)}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),P.ChatGetUser=function(){var e=Object(l.a)(Object(u.a)().mark((function e(t,r){var n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.get("chat/user/".concat(t),{headers:{Authorization:"Bearer ".concat(r)}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),P.ChatGet=function(){var e=Object(l.a)(Object(u.a)().mark((function e(t,r){var n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.get("chat/".concat(t),{headers:{Authorization:"Bearer ".concat(r)}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),P.CreateMessage=function(){var e=Object(l.a)(Object(u.a)().mark((function e(t,r){var n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.post("/chat/message/create",t,{headers:{Authorization:"Bearer ".concat(r)}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();var R=P;function q(){var e=Object(i.o)(),t=Object(n.useState)(""),r=Object(j.a)(t,2),a=(r[0],r[1],Object(n.useState)("")),c=Object(j.a)(a,2),s=(c[0],c[1],Object(n.useState)(null)),O=Object(j.a)(s,2),f=(O[0],O[1]),g=T(),v=F(),k=function(){var t=Object(l.a)(Object(u.a)().mark((function t(r){var n,a,c;return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&r.preventDefault(),t.prev=1,!(""==(n=new FormData(r.currentTarget)).get("username")&""==n.get("password"))){t.next=5;break}return t.abrupt("return");case 5:return console.log("login"),console.log({username:n.get("username"),password:n.get("password")}),t.next=9,R.Login({username:n.get("username"),password:n.get("password")});case 9:if(a=t.sent,console.log(a.access_token),!a.access_token){t.next=23;break}return console.log(a.access_token),g.setToken(a.access_token),y(a.access_token),t.next=17,R.GetMe(a.access_token);case 17:c=t.sent,console.log(c.data),v.setUser(c.data),S(c.data),f(null),"superuser"===c.data.role?e("/admin/chat"):e("/user/chat");case 23:t.next=32;break;case 25:t.prev=25,t.t0=t.catch(1),I(),g.setToken(null),v.setUser({}),console.log(t.t0),t.t0.response?f(t.t0.response.data.detail):(t.t0.request,f(t.t0.message));case 32:case"end":return t.stop()}}),t,null,[[1,25]])})));return function(e){return t.apply(this,arguments)}}();return Object(w.jsx)(d.a,{sx:{flexGrow:1},children:C()?Object(w.jsxs)("div",{children:[Object(w.jsx)("p",{children:"you are logged in"}),Object(w.jsx)(o.b,{to:"/user/chat",children:"Click to login"})]}):Object(w.jsx)(b.a,{component:"main",maxWidth:"xs",children:Object(w.jsxs)(d.a,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(w.jsx)(p.a,{component:"h1",variant:"h5",children:"Sign in"}),Object(w.jsxs)(d.a,{component:"form",onSubmit:k,noValidate:!0,sx:{mt:1},children:[Object(w.jsx)(x.a,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"username",autoFocus:!0}),Object(w.jsx)(x.a,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password"}),Object(w.jsx)(h.a,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"Sign In"}),Object(w.jsx)(m.a,{container:!0,children:Object(w.jsx)(m.a,{item:!0,children:Object(w.jsx)(o.b,{to:"/registration",variant:"body2",children:"Don't have an account? Sign Up"})})})]})]})})})}function z(){var e=Object(i.o)(),t=Object(n.useState)(""),r=Object(j.a)(t,2),a=(r[0],r[1],Object(n.useState)("")),c=Object(j.a)(a,2),s=(c[0],c[1],Object(n.useState)(null)),m=Object(j.a)(s,2),O=m[0],f=m[1],g=(T(),F(),function(){var t=Object(l.a)(Object(u.a)().mark((function t(r){var n,a;return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&r.preventDefault(),t.prev=1,!(""==(n=new FormData(r.currentTarget)).get("username")&""==n.get("password"))){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,R.Registration({username:n.get("username"),password:n.get("password")});case 7:a=t.sent,console.log(a),a.username&&(f(null),e("/login")),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(1),t.t0.response?f(t.t0.response.data.detail):(t.t0.request,f(t.t0.message)),e("/registration");case 16:case"end":return t.stop()}}),t,null,[[1,12]])})));return function(e){return t.apply(this,arguments)}}());return Object(w.jsx)(d.a,{sx:{flexGrow:1},children:C()?Object(w.jsxs)("div",{children:[Object(w.jsx)("p",{children:"you are logged in"}),Object(w.jsx)(o.b,{to:"/user/chat",children:"Click to login"})]}):Object(w.jsx)(b.a,{component:"main",maxWidth:"xs",children:Object(w.jsxs)(d.a,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(w.jsx)(p.a,{component:"h1",variant:"h5",children:"Sign Up"}),Object(w.jsx)(p.a,{variant:"subtitle2",children:O}),Object(w.jsxs)(d.a,{component:"form",onSubmit:g,noValidate:!0,sx:{mt:1},children:[Object(w.jsx)(x.a,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"username",autoFocus:!0}),Object(w.jsx)(x.a,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password"}),Object(w.jsx)(h.a,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"Sign Up"})]})]})})})}var A=r(192),E=r(188),B=r(206),L=r(205),H=r(201),V=r(195),J=r(189),K=r(202);function N(){var e=Object(i.o)(),t=Object(n.useState)([]),r=Object(j.a)(t,2),c=r[0],s=r[1],o=Object(n.useState)(Date.now()),x=Object(j.a)(o,2),h=(x[0],x[1],F()),m=T();Object(n.useEffect)((function(){var e=function(){var e=Object(l.a)(Object(u.a)().mark((function e(){var t,r,n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0!==h.user.id){e.next=10;break}return e.next=4,R.GetMe(m.token);case 4:t=e.sent,console.log(t.data),h.setUser(t.data),console.log(h),e.next=14;break;case 10:return e.next=12,R.ChatGetAdmin(h.user.id,m.token);case 12:r=e.sent,s(r.data);case 14:e.next=24;break;case 16:return e.prev=16,e.t0=e.catch(0),console.log(h.user),e.next=21,R.GetMe(m.token);case 21:n=e.sent,console.log(m.token),h.setUser(n.data);case 24:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(){return e.apply(this,arguments)}}(),t=setInterval((function(){return e()}),1e3);return function(){clearInterval(t)}}),[]);var O=c.map((function(t,r){return Object(w.jsxs)(a.a.Fragment,{children:[Object(w.jsx)(A.a,{children:Object(w.jsxs)(E.a,{alignItems:"flex-start",onClick:(n={chat_id:t.id},function(t){e("/admin/chat/messages",{state:{params:n}})}),children:[Object(w.jsx)(H.a,{children:Object(w.jsx)(V.a,{sx:{bgcolor:J.a[500]},children:t.user.username[0].toUpperCase()})}),Object(w.jsx)(B.a,{primary:t.user.username,secondary:Object(w.jsxs)(a.a.Fragment,{children:[Object(w.jsx)(p.a,{sx:{display:"inline"},component:"span",variant:"body2",color:"text.primary",children:t.last_message.username})," - ".concat(t.last_message.message.substring(0,50),"...")]})})]})},r),Object(w.jsx)(K.a,{variant:"inset",component:"li"})]});var n}));return Object(w.jsx)(b.a,{component:"main",maxWidth:"m",children:Object(w.jsxs)(d.a,{sx:{boxShadow:3,borderRadius:2,px:4,py:6,marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(w.jsx)(p.a,{component:"h1",variant:"h5",children:"Chat"}),Object(w.jsx)(L.a,{sx:{width:"100%",maxWidth:460,bgcolor:"background.paper"},children:O})]})})}function Q(){var e=Object(i.o)(),t=Object(n.useState)([]),r=Object(j.a)(t,2),c=r[0],s=r[1],o=Object(n.useState)(Date.now()),x=Object(j.a)(o,2),h=(x[0],x[1],Object(n.useState)({})),m=Object(j.a)(h,2),O=(m[0],m[1],F()),f=T();Object(n.useEffect)((function(){var e=function(){var e=Object(l.a)(Object(u.a)().mark((function e(){var t,r,n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0!==O.user.id){e.next=10;break}return e.next=4,R.GetMe(f.token);case 4:t=e.sent,console.log(t.data),O.setUser(t.data),console.log(O),e.next=14;break;case 10:return e.next=12,R.ChatGetUser(O.user.id,f.token);case 12:r=e.sent,s(r.data);case 14:e.next=24;break;case 16:return e.prev=16,e.t0=e.catch(0),console.log(e.t0),e.next=21,R.GetMe(f.token);case 21:n=e.sent,console.log(f.token),O.setUser(n.data);case 24:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(){return e.apply(this,arguments)}}(),t=setInterval((function(){return e()}),1e3);return function(){clearInterval(t)}}),[]);var g=c.map((function(t,r){return Object(w.jsxs)(a.a.Fragment,{children:[Object(w.jsx)(A.a,{children:Object(w.jsxs)(E.a,{alignItems:"flex-start",onClick:(n={chat_id:t.id},function(t){e("/user/chat/messages",{state:{params:n}})}),children:[Object(w.jsx)(H.a,{children:Object(w.jsx)(V.a,{sx:{bgcolor:J.a[500]},children:t.user.username[0].toUpperCase()})}),Object(w.jsx)(B.a,{primary:t.user.username,secondary:Object(w.jsxs)(a.a.Fragment,{children:[Object(w.jsx)(p.a,{sx:{display:"inline"},component:"span",variant:"body2",color:"text.primary",children:t.last_message.username})," - ".concat(t.last_message.message.substring(0,50),"...")]})})]})},r),Object(w.jsx)(K.a,{variant:"inset",component:"li"})]});var n}));return Object(w.jsx)(b.a,{component:"main",maxWidth:"m",children:Object(w.jsxs)(d.a,{sx:{boxShadow:3,borderRadius:2,px:4,py:6,marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(w.jsx)(p.a,{component:"h1",variant:"h5",children:"Chat"}),Object(w.jsx)(L.a,{sx:{width:"100%",maxWidth:460,bgcolor:"background.paper"},children:g})]})})}function X(){return Object(w.jsx)("h4",{children:"Permission denied!"})}var Y=r(203),Z=r(204),$=r(99),ee=r.n($);function te(){var e=Object(i.o)(),t=T(),r=F();return Object(w.jsx)(n.Fragment,{children:Object(w.jsx)(d.a,{sx:{flexGrow:1},children:Object(w.jsx)(Y.a,{position:"static",children:Object(w.jsxs)(Z.a,{children:[Object(w.jsx)(d.a,{mr:2,children:Object(w.jsx)(ee.a,{})}),Object(w.jsx)(p.a,{variant:"h6",component:"div",sx:{flexGrow:1},children:Object(w.jsx)(h.a,{color:"inherit",onClick:function(){"superuser"==r.user.role?e("/admin/chat"):e("user/chat")},children:"Wise Chat"})}),C()?Object(w.jsx)(h.a,{color:"inherit",onClick:function(){I(),t.setToken(null),r.setUser({}),e("/login")},children:"Logout"}):Object(w.jsx)(h.a,{color:"inherit",onClick:function(){e("/login")},children:"Login"})]})})})})}var re=r(197),ne=[{id:1,text:"Hi there!",sender:"bot"},{id:2,text:"Hello!",sender:"user"},{id:3,text:"How can I assist you today?",sender:"bot"}];function ae(){var e=Object(i.o)(),t=Object(n.useState)(""),r=Object(j.a)(t,2),a=r[0],c=r[1],s=Object(n.useState)([]),o=Object(j.a)(s,2),b=o[0],p=o[1],O=Object(n.useState)({}),f=Object(j.a)(O,2),g=(f[0],f[1]),v=F(),k=T(),y=Object(i.m)().state.params.chat_id;return Object(n.useEffect)((function(){var t=function(){var t=Object(l.a)(Object(u.a)().mark((function t(){var r,n;return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,void 0!==v.user.id){t.next=8;break}return t.next=4,R.GetMe(k.token);case 4:r=t.sent,v.setUser(r.data),t.next=12;break;case 8:return t.next=10,R.ChatGet(y,k.token);case 10:n=t.sent,p(n.data.messages);case 12:t.next=18;break;case 14:t.prev=14,t.t0=t.catch(0),console.log(t.t0.response.status),401==t.t0.response.status&&(I(),k.setToken(null),v.setUser({}),e("/login"));case 18:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(){return t.apply(this,arguments)}}(),r=setInterval((function(){return t()}),1e3);return function(){clearInterval(r)}}),[b]),Object(w.jsxs)(d.a,{sx:{height:"90vh",display:"flex",flexDirection:"column",bgcolor:"grey.200"},children:[Object(w.jsx)(d.a,{sx:{flexGrow:1,overflow:"auto",p:2},children:b.map((function(e){return Object(w.jsx)(ce,{message:e,user_id:v.user},e.id)}))}),Object(w.jsx)(d.a,{sx:{p:2,backgroundColor:"background.default"},children:Object(w.jsxs)(m.a,{container:!0,spacing:2,children:[Object(w.jsx)(m.a,{item:!0,xs:10,children:Object(w.jsx)(x.a,{fullWidth:!0,size:"small",placeholder:"Type a message",variant:"outlined",value:a,onChange:function(e){c(e.target.value)}})}),Object(w.jsx)(m.a,{item:!0,xs:2,children:Object(w.jsx)(h.a,{fullWidth:!0,size:"large",color:"primary",variant:"contained",onClick:function(){if(""!==a.trim()){g();var e=function(){var e=Object(l.a)(Object(u.a)().mark((function e(){var t,r;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log(v.user.id),console.log({chat_id:y,user_id:parseInt(v.user.id),message:a}),(t=new FormData).append("chat_id",y),t.append("user_id",parseInt(v.user.id)),t.append("message",a),e.next=9,R.CreateMessage({chat_id:t.get("chat_id"),user_id:t.get("user_id"),message:t.get("message")},k.token);case 9:r=e.sent,console.log(r.data),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}();e(),c("")}},children:"Send"})})]})})]})}var ce=function(e){var t=e.message,r=e.user_id,a=Object(n.useRef)(null),c=1==t.user_id;return Object(n.useEffect)((function(){!function(){var e;null===(e=a.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}()}),[ne]),Object(w.jsxs)(d.a,{sx:{display:"flex",mb:2,flexDirection:c?"row":"row-reverse",alignItems:"center"},children:[Object(w.jsx)(V.a,{sx:{bgcolor:c?"primary.main":"secondary.main"},children:"superuser"==r.role?c?"W":"U":c?"W":r.username[0].toUpperCase()}),Object(w.jsx)(re.a,{variant:"outlined",sx:{p:2,ml:c?1:0,mr:c?0:1,backgroundColor:c?"primary.light":"secondary.light",borderRadius:c?"20px 20px 20px 5px":"20px 20px 5px 20px"},children:Object(w.jsx)(p.a,{variant:"body1",children:t.message})}),Object(w.jsx)("div",{ref:a})]})};function se(){var e=C(),t=function(){var e={username:localStorage.getItem("username"),id:localStorage.getItem("user_id"),role:localStorage.getItem("role"),created_at:localStorage.getItem("created_at")};return console.log(e),e}();return Object(n.useEffect)((function(){document.title="WISE+"}),[]),Object(w.jsx)(a.a.StrictMode,{children:Object(w.jsx)(o.a,{children:Object(w.jsx)(_,{tokenData:e,children:Object(w.jsxs)(U,{userData:t,children:[Object(w.jsx)(te,{}),Object(w.jsxs)(i.d,{children:[Object(w.jsx)(i.b,{path:"/login/*",element:Object(w.jsx)(q,{})}),Object(w.jsx)(i.b,{path:"/registration/*",element:Object(w.jsx)(z,{})}),Object(w.jsx)(i.b,{path:"/admin/chat/*",element:Object(w.jsx)(D,{children:Object(w.jsx)(G,{children:Object(w.jsx)(N,{})})})}),Object(w.jsx)(i.b,{path:"/admin/chat/messages/*",element:Object(w.jsx)(D,{children:Object(w.jsx)(G,{children:Object(w.jsx)(ae,{})})})}),Object(w.jsx)(i.b,{path:"/user/chat/*",element:Object(w.jsx)(D,{children:Object(w.jsx)(W,{children:Object(w.jsx)(Q,{})})})}),Object(w.jsx)(i.b,{path:"/user/chat/messages/*",element:Object(w.jsx)(D,{children:Object(w.jsx)(W,{children:Object(w.jsx)(ae,{})})})}),Object(w.jsx)(i.b,{path:"/error/*",element:Object(w.jsx)(X,{})}),Object(w.jsx)(i.b,{path:"/",element:Object(w.jsx)(i.a,{to:"/user/chat",replace:!0})})]})]})})})})}s.a.createRoot(document.getElementById("root")).render(Object(w.jsx)(se,{}))}},[[133,1,2]]]);
//# sourceMappingURL=main.1e08bf4e.chunk.js.map